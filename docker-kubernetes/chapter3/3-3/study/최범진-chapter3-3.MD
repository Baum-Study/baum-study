### 파드의 컨테이너 자동 복구 방법

- **자동 복구 및 셀프 힐링(Self-healing)**: 쿠버네티스는 장애가 발생한 파드를 자동으로 복구하도록 설계되어 있습니다. 셀프 힐링 기능은 파드 내의 컨테이너가 비정상적으로 작동할 때 이를 자동으로 재시작하거나 교체하여 파드의 정상적인 작동을 보장합니다. 이 과정은 주로 디플로이먼트(Deployment) 또는 레플리카셋(ReplicaSet) 등의 리소스 컨트롤러에 의해 관리됩니다.

### 파드의 동작 보증 기능

- **파드 자동 복구**: 쿠버네티스는 파드 자체에 문제가 발생했을 때 파드를 자동으로 복구하여 항상 동작 상태를 유지하도록 보장합니다. 이 기능을 활용하기 위해서는 디플로이먼트(Deployment)를 사용하여 파드를 생성해야 합니다. 디플로이먼트는 파드 템플릿을 기반으로 원하는 상태를 정의하고, 현재 상태와 원하는 상태를 비교하여 차이가 있을 경우 이를 자동으로 조정합니다.

### 노드 자원 보호하기

- **노드의 역할과 관리**: 노드는 쿠버네티스 클러스터에서 파드를 실행하는 역할을 하며, 쿠버네티스 스케줄러는 파드를 노드에 할당합니다. 노드에 문제가 생길 가능성이 있을 때 이를 관리하기 위해 `cordon` 명령을 사용합니다. `cordon` 명령은 해당 노드를 스케줄링에서 제외(SchedulingDisabled 상태)하여 새로운 파드가 할당되지 않도록 합니다. 이는 노드의 문제로 인해 파드가 영향을 받는 것을 최소화하기 위한 조치입니다.
- **노드 상태 관리**: 노드의 상태를 `uncordon` 명령을 사용하여 다시 정상 상태로 복원할 수 있습니다. `uncordon` 명령을 실행하면 해당 노드는 다시 파드를 할당받을 수 있게 됩니다.

### 노드 유지보수하기

- **유지보수 대비**: 쿠버네티스를 운영하면서 정기적 또는 비정기적인 유지보수를 위해 노드를 중지해야 할 경우 `drain` 기능을 사용합니다. `drain` 명령은 지정된 노드의 파드를 다른 노드로 이동시켜 해당 노드에서 유지보수를 진행할 수 있도록 합니다. 이 과정에서 파드는 노드에서 삭제되고, 스케줄러는 동일한 파드를 다른 노드에서 다시 생성합니다.
- **DaemonSet 처리**: `drain` 명령은 각 노드에 하나만 존재하는 DaemonSet 파드를 삭제하지 않으며, 이를 무시하기 위해 `-ignore-daemonsets` 옵션을 사용할 수 있습니다.

### 파드 업데이트하고 복구하기

### 파드 업데이트 하기

- **히스토리 기록**: 파드를 업데이트할 때 `-record` 옵션을 사용하여 배포 정보의 히스토리를 기록할 수 있습니다. 이는 `kubectl rollout history` 명령을 통해 확인할 수 있으며, 업데이트 이력과 함께 각 버전에서 수행된 명령을 추적할 수 있습니다.
- **순차적 업데이트**: 파드를 업데이트하는 동안 시스템 영향을 최소화하기 위해 레플리카셋의 파드 수를 조정하여 순차적으로 파드를 교체합니다. 이는, 모든 파드를 한 번에 지우지 않고 하나씩 교체하여 안정성을 유지합니다.

### 업데이트 실패시 파드 복구하기

1. **문제점 파악**: `kubectl rollout status` 명령어로 현재 디플로이먼트의 상태를 확인하고, `kubectl describe` 명령어로 상세 정보를 조회하여 문제점을 파악합니다.
2. **히스토리 확인**: `kubectl rollout history` 명령어를 통해 업데이트 이력을 확인하고, 특정 업데이트 명령을 조회합니다.
3. **명령 실행 취소**: `kubectl rollout undo` 명령어를 사용하여 마지막 업데이트를 취소하고 이전 상태로 복구합니다.
4. **변경 확인**: `kubectl rollout status` 명령어로 변경 사항이 정상적으로 적용되었는지 확인합니다.
5. **정상 상태 확인**: `kubectl describe` 명령어로 현재 디플로이먼트가 정상 상태인지 확인합니다.

### 특정 시점으로 파드 복구하기

- **특정 시점 복구**: `-to-revision` 옵션을 사용하여 특정 버전으로 디플로이먼트를 복구할 수 있습니다. 예를 들어, `kubectl rollout undo --to-revision=2` 명령을 사용하면 두 번째 리비전으로 복구됩니다. 이는 문제가 발생했을 때 특정 안정적인 버전으로 돌아가도록 돕습니다.
