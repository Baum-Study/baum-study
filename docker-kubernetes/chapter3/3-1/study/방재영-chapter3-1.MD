## 쿠버네티스
- 컨테이너 오케스트레이션 도구
- 오케스트레이션: 다수의 컴퓨팅 자원, 애플리케이션, 서비스들을 조율하고 관리하는 것   

## 여러 오케스트레이션 도구
- 도커 스웜
  - 설치 및 사용 간단
  - 기능이 다양하지 않기에 대규모 서버 환경에 적용하려면 사용자 환경 변경 필요    
- 메소스
  - 기능을 충분히 활용하려면 분산 관리 시스템과의 연동 필요
- 노매드
  - 베이그런트처럼 간단한 구성으로 제공
  - 기능이 부족하므로 가볍고 간단한 기능만 필요한 환경에서 사용하기를 권장됨
- 쿠버네티스
  - 시작하는 데에 난이도가 있지만, 쉽게 사용할 수 있도록 도와주는 도구들이 존재
  - 지속적으로 발전되고 있으며, 거의 대부분의 벤더와 오픈소스 진영에서 쿠버네티스를 지원하고 있음

## 쿠버네티스 구성 방법
1. 퍼블릭 클라우드 업체에서 제공하는 쿠버네티스 (EKS, AKS, GKE)
2. 플랫폼 업체에서 제공하는 설치형 쿠버네티스 (Rancher, OpenShift)
3. 쿠버네티스를 자동으로 구성해주는 솔루션 (Kubeadm, kops, KRIB, kubespray)

**여러 방법 중에서 Kubeadm이 어렵긴 하지만, 사용자가 변경하기 좋고 온프레미스와 클라우드를 모두 지원함**

<br/>

## 파드 배포 중심의 쿠버네티스 구성요소
### 1. 마스터 노드   
- kubectl
  - 쿠버네티스 클러스터에 명령을 내리는 역할
  - 주로 API 서버와 통신하므로, 마스터 노드에 구성하는 것이 적절   
- API 서버
  - 쿠버네티스 클러스터의 중심 역할을 하는 통로
  - 주로 상태값을 저장하는 etcd와 통신하지만, 그 밖의 요소들 또한 API 서버를 중심에 두고 통신하므로 매우 중요한 역할   
- etcd
  - 구성 요소들의 상태값이 모두 저장되는 곳
  - etcd의 정보만 백업되어 있다면, 긴급한 장애 상황에서도 쿠버네티스 클러스터 복구 가능
  - 분산 저장이 가능한 key-value 저장소이므로, 복제해서 시스템의 가용성 확보 가능   
- 컨트롤러 매니저
  - 쿠버네티스 클러스터의 오브젝트 상태 관리
  - 다양한 상태값을 관리하는 주체들이 여기에 소속되어 각자의 역할을 수행(노드 컨트롤러, 레플리카셋 컨트롤러, ...)
- 스케줄러
  - 노드의 상태와 자원, 레이블, 요구조건 등을 고려
  - 파드를 어떤 워커 노드에 생성할 것인지 결정하여 할당, 할당된 일정을 관리하는 역할

### 2. 워커 노드
- kubelet
  - 파드의 구성내용을 받아 컨테이너 런타임으로 전달
  - 파드 안의 컨테이너들의 정상 동작 모니터링   
- 컨테이너 런타임
  - 파드를 이루는 컨테이너의 실행 담당
  - 파드 안의 다양한 종류의 컨테이너가 문제없이 작동하게 만드는 표준 인터페이스
- 파드
  - 한 개 이상의 컨테이너로 단일 목적의 일을 하기 위해 모인 단위
  - 웹 서버가 될 수도 있고, 로그나 데이터를 분석할 수도 있음
  - 파드는 언제라도 죽을 수 있음


## 파드의 생명주기
<img src="https://github.com/user-attachments/assets/0144ab8b-eb6f-493f-ac1f-2d741f15c9e5" width="700" height="450" alt="pod lifecycle">

1. kubectl을 통해 API 서버에 파드 생성 요청
2. API 서버는 전달된 내용을 etcd에 기록하여 클러스터의 상태값을 최신으로 유지
3. 컨트롤러 매니저가 파드 생성 요청을 인지하여 파드 생성 및 상태를 API 서버에 전달
4. API 서버에 파드가 생성된 걸 스케줄러가 인지하고, 어떤 워커 노드에 적용할지 결정하여 띄우도록 요청
5. 스케줄러가 kubelet을 통해 결정한 워커 노드에 파드가 있는지 확인
6. kubelet에서 컨테이너 런타임으로 파드 생성 요청
7. 최종적으로 사용 가능 상태인 파드가 생성됨

**쿠버네티스는 선언적인 시스템 구조로서, 각 요소가 추구하는 상태를 선언하면 현재 상태와 맞는지 점검하고 그에 맞추려 노력하는 구조**