# 쿠버네티스 연결을 담당하는 서비스

쿠버네티스에서 `서비스`란 무엇일까요??  
일반적으로 우리가 `서비스`라고 부를 땐 웹 서비스나 API 서비스를 의미합니다.  
하지만 쿠버네티스에서의 `서비스`는 조금 다릅니다.  
쿠버네티스에서의 `서비스`는 `파드`를 외부로 노출하고 클러스터 내부에서 통신할 수 있도록 해주는 역할을 합니다.  
쿠버네티스에서는 `서비스`를 생성할 때 `서비스 타입`을 지정해야 합니다.  
`서비스 타입`은 `ClusterIP`, `NodePort`, `Ingress`, `LoadBalancer`, `ExternalName`이 있습니다.  
여기서 우리는 `ClusterIP`와 `NodePort`, `Ingress`, `LoadBalancer`에 대해 알아보려고 합니다.

## ClusterIP

ClusterIP는 이 책에서 배우지 않았지만 쿠버네티스에서 가장 기본적인 서비스 타입입니다.  
ClusterIP는 클러스터 내부에서만 사용할 수 있으며 클러스터 내부의 파드에 대한 서비스를 생성할 때 사용합니다.  
보안적인 이유로 클러스터 외부에서 접근할 수 없습니다.

## NodePort

`NodePort`는 클러스터 내부의 모든 노드에 서비스를 노출하는 방법입니다.  
NodePort를 사용하면 모든 워커 노드의 특정 포트를 열고 해당 포트로 들어오는 요청을 NordPort 서비스로 전달합니다.  
그리고 Nord Port 서비스는 클러스터 내부의 파드로 요청을 전달합니다.

유즈케이스 모델로 본다면  
사용자 요청 -> 워커 노드의 특정 포트 -> NordPort 서비스 -> 클러스터 내부의 파드

## Ingress

하지만 NodePort 서비스는 포트를 중복 사용할 수 없어 1개의 Deployment에 1개의 NodePort 서비스만 사용할 수 있습니다.  
그리고 노드의 IP 주소를 알아야 하기 때문에 외부에서 접근하기 어렵습니다.  
여러개의 Deployment를 사용할 때는 `Ingress`를 사용하는 것이 좋습니다.  
Ingress는 고유한 주소를 가지고 있으며 클러스터 내부의 서비스에 대한 HTTP 및 HTTPS 라우팅도 제공합니다.  
Ingress를 사용하려면 Ingress Controller가 필요하고 쿠버네티스는 Nginx Ingress Controller를 공식적으로 제공합니다.

유즈케이스 모델로 본다면
사용자 요청 -> 워커 노드의 특정 포트 -> Ingress Controller -> 클러스터 내부의 파드

## LoadBalancer

위에서 배운 연결 방식은 모두 워커 노드의 노드 포트를 통해 내부 서비스에 연결했습니다.  
하지만 `LoadBalancer`는 `클라우드 제공업체의 로드 밸런서`를 사용하여 클러스터 내부의 서비스를 외부로 노출합니다.  
LoadBalancer를 사용하면 클러스터 외부에서 클러스터 내부의 서비스에 접근할 수 있습니다.  